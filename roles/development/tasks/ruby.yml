---
- name: Unarchive ruby-install
  unarchive:
    remote_src: True
    src: https://github.com/postmodern/ruby-install/archive/v0.7.0.tar.gz
    dest: /tmp/ruby-install-0.7.0
  register: ruby-install_unarchive

- name: Install ruby-install
  shell: make install chdir=/tmp/ruby-install-0.7.0
  when: ruby-install_unarchive.changed

- name: Unarchive chruby
  unarchive:
    remote_src: True
    src: https://github.com/postmodern/chruby/archive/v0.3.9.tar.gz
    dest: /tmp/chruby-0.3.9
  register: chruby_unarchive

- name: Install chruby
  shell: make install chdir=/tmp/chruby-0.3.9
  when: chruby_unarchive.changed

- name: Install latest ruby
  become_user: "{{ primary_user }}"
  shell: ruby-install ruby 2.5

- name: Install bundler
  become_user: "{{ primary_user }}"
  shell: chruby 2.5 && gem install bundler
